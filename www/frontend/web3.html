<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GuardianShield - Web3 DApp</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
        }

        .logo {
            font-size: 3em;
            font-weight: bold;
            background: linear-gradient(45deg, #00d4ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .tagline {
            font-size: 1.2em;
            color: #888;
            margin-bottom: 30px;
        }

        .status-bar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff4444;
        }

        .status-dot.connected {
            background: #00ff88;
        }

        .wallet-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .btn {
            background: linear-gradient(45deg, #00d4ff, #00ff88);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 212, 255, 0.3);
        }

        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .contracts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .contract-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .contract-card:hover {
            transform: translateY(-5px);
            border-color: #00d4ff;
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.2);
        }

        .contract-title {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #00d4ff;
        }

        .contract-address {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            word-break: break-all;
        }

        .contract-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9em;
        }

        .agent-status {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .agent-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #00d4ff;
        }

        .transaction-status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }

        .transaction-status.success {
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid #00ff88;
        }

        .transaction-status.error {
            background: rgba(255, 68, 68, 0.2);
            border: 1px solid #ff4444;
        }

        .transaction-status.pending {
            background: rgba(255, 165, 0, 0.2);
            border: 1px solid #ffa500;
        }

        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üõ°Ô∏è GuardianShield</div>
            <div class="tagline">Decentralized Autonomous Cybersecurity Platform</div>
        </div>

        <div class="status-bar">
            <div class="status-item">
                <div class="status-dot" id="walletStatus"></div>
                <span id="walletStatusText">Wallet Disconnected</span>
            </div>
            <div class="status-item">
                <div class="status-dot" id="networkStatus"></div>
                <span id="networkStatusText">Network: Not Connected</span>
            </div>
            <div class="status-item">
                <span id="addressDisplay">Address: Not Connected</span>
            </div>
            <div class="status-item">
                <span id="balanceDisplay">Balance: 0 ETH</span>
            </div>
        </div>

        <div class="wallet-section">
            <h2>Connect Your Wallet</h2>
            <p>Connect your wallet to interact with GuardianShield contracts</p>
            <button class="btn" id="connectWallet">Connect Wallet</button>
            <button class="btn" id="disconnectWallet" style="display: none;">Disconnect</button>
        </div>

        <div class="agent-status">
            <h2>ü§ñ AI Agent Status</h2>
            <div class="agent-grid" id="agentGrid">
                <!-- Populated by JavaScript -->
            </div>
        </div>

        <div class="contracts-grid" id="contractsGrid">
            <!-- Populated by JavaScript -->
        </div>

        <div class="transaction-status" id="transactionStatus">
            <div id="transactionMessage"></div>
        </div>

        <div class="footer">
            <p>üõ°Ô∏è GuardianShield - Securing the Future with AI-Powered Cybersecurity</p>
            <p>Built on Ethereum ‚Ä¢ Deployed with ‚ù§Ô∏è</p>
        </div>
    </div>

    <script>
        class GuardianShieldDApp {
            constructor() {
                this.provider = null;
                this.signer = null;
                this.userAddress = null;
                this.contracts = {};
                this.contractAddresses = {};
                this.isConnected = false;
                
                this.init();
            }

            async init() {
                this.setupEventListeners();
                await this.loadContractAddresses();
                this.renderAgentStatus();
                this.renderContractCards();
                
                if (window.ethereum && localStorage.getItem('walletConnected') === 'true') {
                    await this.connectWallet();
                }
            }

            setupEventListeners() {
                document.getElementById('connectWallet').addEventListener('click', () => this.connectWallet());
                document.getElementById('disconnectWallet').addEventListener('click', () => this.disconnectWallet());
                
                if (window.ethereum) {
                    window.ethereum.on('accountsChanged', (accounts) => {
                        if (accounts.length === 0) {
                            this.disconnectWallet();
                        } else {
                            this.updateWalletStatus();
                        }
                    });
                    
                    window.ethereum.on('chainChanged', () => {
                        window.location.reload();
                    });
                }
            }

            async loadContractAddresses() {
                this.contractAddresses = {
                    guardianToken: "0x0000000000000000000000000000000000000000",
                    guardianTreasury: "0x0000000000000000000000000000000000000000",
                    guardianShieldToken: "0x0000000000000000000000000000000000000000",
                    guardianStaking: "0x0000000000000000000000000000000000000000",
                    guardianLiquidityPool: "0x0000000000000000000000000000000000000000",
                    dmer: "0x0000000000000000000000000000000000000000",
                    evolutionaryUpgradeable: "0x0000000000000000000000000000000000000000"
                };

                try {
                    const response = await fetch('./deployment-sepolia.json');
                    if (response.ok) {
                        const deployment = await response.json();
                        this.contractAddresses = deployment.contracts;
                        console.log('Loaded contract addresses from deployment file');
                    }
                } catch (error) {
                    console.log('Deployment file not found, using placeholder addresses');
                }
            }

            async connectWallet() {
                if (!window.ethereum) {
                    this.showTransaction('error', 'MetaMask not found! Please install MetaMask.');
                    return;
                }

                try {
                    this.showTransaction('pending', 'Connecting to wallet...');
                    
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    
                    this.provider = new ethers.providers.Web3Provider(window.ethereum);
                    this.signer = this.provider.getSigner();
                    this.userAddress = await this.signer.getAddress();
                    this.isConnected = true;
                    
                    localStorage.setItem('walletConnected', 'true');
                    
                    await this.updateWalletStatus();
                    await this.loadContracts();
                    
                    document.getElementById('connectWallet').style.display = 'none';
                    document.getElementById('disconnectWallet').style.display = 'inline-block';
                    
                    this.showTransaction('success', 'Wallet connected successfully!');
                    setTimeout(() => this.hideTransaction(), 3000);
                    
                } catch (error) {
                    console.error('Connection error:', error);
                    this.showTransaction('error', 'Failed to connect wallet');
                }
            }

            disconnectWallet() {
                this.provider = null;
                this.signer = null;
                this.userAddress = null;
                this.isConnected = false;
                this.contracts = {};
                
                localStorage.removeItem('walletConnected');
                
                document.getElementById('connectWallet').style.display = 'inline-block';
                document.getElementById('disconnectWallet').style.display = 'none';
                
                this.updateWalletStatus();
                this.renderContractCards();
                
                this.showTransaction('success', 'Wallet disconnected');
                setTimeout(() => this.hideTransaction(), 2000);
            }

            async updateWalletStatus() {
                if (!this.isConnected) {
                    document.getElementById('walletStatus').classList.remove('connected');
                    document.getElementById('walletStatusText').textContent = 'Wallet Disconnected';
                    document.getElementById('networkStatusText').textContent = 'Network: Not Connected';
                    document.getElementById('addressDisplay').textContent = 'Address: Not Connected';
                    document.getElementById('balanceDisplay').textContent = 'Balance: 0 ETH';
                    return;
                }

                try {
                    const network = await this.provider.getNetwork();
                    const balance = await this.provider.getBalance(this.userAddress);
                    
                    document.getElementById('walletStatus').classList.add('connected');
                    document.getElementById('networkStatus').classList.add('connected');
                    document.getElementById('walletStatusText').textContent = 'Wallet Connected';
                    document.getElementById('networkStatusText').textContent = `Network: ${network.name} (${network.chainId})`;
                    document.getElementById('addressDisplay').textContent = `Address: ${this.userAddress.substring(0, 6)}...${this.userAddress.substring(38)}`;
                    document.getElementById('balanceDisplay').textContent = `Balance: ${parseFloat(ethers.utils.formatEther(balance)).toFixed(4)} ETH`;
                } catch (error) {
                    console.error('Error updating wallet status:', error);
                }
            }

            async loadContracts() {
                if (!this.signer) return;

                const tokenABI = [
                    "function name() view returns (string)",
                    "function symbol() view returns (string)",
                    "function totalSupply() view returns (uint256)",
                    "function balanceOf(address) view returns (uint256)"
                ];

                try {
                    this.contracts.guardianToken = new ethers.Contract(
                        this.contractAddresses.guardianToken,
                        tokenABI,
                        this.signer
                    );
                } catch (error) {
                    console.error('Error loading contracts:', error);
                }
            }

            renderAgentStatus() {
                const agentGrid = document.getElementById('agentGrid');
                const agents = [
                    { name: 'üß† Learning Agent', status: 'Active ‚Ä¢ Evolving' },
                    { name: 'üìä Behavioral Analytics', status: 'Monitoring ‚Ä¢ 24/7' },
                    { name: 'üîç DMER Monitor', status: 'Scanning ‚Ä¢ Real-time' },
                    { name: 'üõ°Ô∏è Threat Response', status: 'Ready ‚Ä¢ Automated' },
                    { name: 'üî¨ Genetic Evolver', status: 'Optimizing ‚Ä¢ Continuous' },
                    { name: 'üåê External Integration', status: 'Connected ‚Ä¢ Multi-chain' }
                ];

                agentGrid.innerHTML = agents.map(agent => `
                    <div class="agent-card">
                        <div style="font-weight: bold; margin-bottom: 5px;">${agent.name}</div>
                        <div style="color: #888; font-size: 0.9em;">${agent.status}</div>
                    </div>
                `).join('');
            }

            renderContractCards() {
                const contractsGrid = document.getElementById('contractsGrid');
                const contractConfigs = [
                    {
                        name: 'GuardianToken (GUARD)',
                        address: this.contractAddresses.guardianToken,
                        description: 'ERC-20 governance and utility token',
                        actions: ['Check Balance', 'Transfer', 'Approve']
                    },
                    {
                        name: 'GuardianTreasury',
                        address: this.contractAddresses.guardianTreasury,
                        description: 'Multi-signature treasury management',
                        actions: ['View Balance', 'Submit Proposal']
                    },
                    {
                        name: 'GuardianShield NFT',
                        address: this.contractAddresses.guardianShieldToken,
                        description: 'Security certificates and achievements',
                        actions: ['Mint Certificate', 'View Collection']
                    },
                    {
                        name: 'GuardianStaking',
                        address: this.contractAddresses.guardianStaking,
                        description: 'Stake GUARD tokens for rewards',
                        actions: ['Stake Tokens', 'Claim Rewards', 'Unstake']
                    },
                    {
                        name: 'Liquidity Pool',
                        address: this.contractAddresses.guardianLiquidityPool,
                        description: 'Decentralized exchange liquidity',
                        actions: ['Add Liquidity', 'Remove Liquidity']
                    },
                    {
                        name: 'DMER Protocol',
                        address: this.contractAddresses.dmer,
                        description: 'Decentralized Monitoring & Emergency Response',
                        actions: ['Submit Report', 'View Alerts']
                    }
                ];

                contractsGrid.innerHTML = contractConfigs.map(contract => `
                    <div class="contract-card">
                        <div class="contract-title">${contract.name}</div>
                        <div class="contract-address">${contract.address}</div>
                        <p style="margin-bottom: 15px; color: #ccc; font-size: 0.9em;">${contract.description}</p>
                        <div class="contract-actions">
                            ${contract.actions.map(action => `
                                <button class="btn btn-small" onclick="dapp.handleContractAction('${contract.name}', '${action}')" 
                                        ${!this.isConnected ? 'disabled' : ''}>
                                    ${action}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            }

            async handleContractAction(contractName, action) {
                if (!this.isConnected) {
                    this.showTransaction('error', 'Please connect your wallet first');
                    return;
                }

                this.showTransaction('pending', `Executing ${action} on ${contractName}...`);

                try {
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    this.showTransaction('success', `${action} completed successfully!`);
                    setTimeout(() => this.hideTransaction(), 3000);
                } catch (error) {
                    console.error('Contract action error:', error);
                    this.showTransaction('error', `${action} failed`);
                }
            }

            showTransaction(type, message) {
                const statusElement = document.getElementById('transactionStatus');
                const messageElement = document.getElementById('transactionMessage');
                
                statusElement.className = `transaction-status ${type}`;
                statusElement.style.display = 'block';
                messageElement.textContent = message;
            }

            hideTransaction() {
                document.getElementById('transactionStatus').style.display = 'none';
            }
        }

        const dapp = new GuardianShieldDApp();
    </script>
</body>
</html>