<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GuardianShield Security Tokens | NFT Collection</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="wallet-manager.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 1rem 2rem;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0, 255, 200, 0.2);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #00ffc8, #0088ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .wallet-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: linear-gradient(45deg, #00ffc8, #0088ff);
            color: #000;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 255, 200, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 8rem 2rem 2rem;
        }

        .hero {
            text-align: center;
            margin-bottom: 4rem;
        }

        .hero h1 {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #00ffc8, #0088ff, #ff00aa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: glow 2s ease-in-out infinite alternate;
        }

        .hero p {
            font-size: 1.2rem;
            color: #b0b0b0;
            max-width: 600px;
            margin: 0 auto 2rem;
            line-height: 1.6;
        }

        .shield-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .shield-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(0, 255, 200, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .shield-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(45deg, #00ffc8, #0088ff);
        }

        .shield-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 255, 200, 0.1);
            border-color: rgba(0, 255, 200, 0.5);
        }

        .shield-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 1rem;
            background: linear-gradient(45deg, #00ffc8, #0088ff);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .shield-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #00ffc8;
        }

        .shield-protection {
            font-size: 2rem;
            font-weight: 800;
            margin: 1rem 0;
            color: #ffffff;
        }

        .shield-price {
            font-size: 1.1rem;
            color: #0088ff;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .shield-features {
            list-style: none;
            margin-bottom: 2rem;
        }

        .shield-features li {
            padding: 0.3rem 0;
            color: #b0b0b0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .shield-features li::before {
            content: '‚úì';
            color: #00ffc8;
            font-weight: bold;
        }

        .mint-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 20px;
            padding: 2rem;
            margin: 4rem 0;
            border: 1px solid rgba(0, 255, 200, 0.2);
        }

        .mint-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .quantity-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .quantity-display {
            font-size: 1.5rem;
            font-weight: 700;
            min-width: 60px;
            text-align: center;
        }

        .your-shields {
            margin-top: 4rem;
        }

        .shields-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .owned-shield {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(0, 255, 200, 0.2);
            text-align: center;
            transition: all 0.3s ease;
        }

        .owned-shield:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 255, 200, 0.1);
        }

        .shield-serial {
            font-size: 1.2rem;
            font-weight: 700;
            color: #00ffc8;
            margin-bottom: 0.5rem;
        }

        .shield-status {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 1rem;
        }

        .status-safe {
            background: rgba(0, 255, 200, 0.2);
            color: #00ffc8;
        }

        .status-stolen {
            background: rgba(255, 0, 100, 0.2);
            color: #ff0064;
        }

        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-top: 4rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            border: 1px solid rgba(0, 255, 200, 0.2);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: #00ffc8;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #b0b0b0;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(0, 255, 200, 0.3);
            border-top: 3px solid #00ffc8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes glow {
            from { text-shadow: 0 0 20px rgba(0, 255, 200, 0.5); }
            to { text-shadow: 0 0 30px rgba(0, 136, 255, 0.5); }
        }

        .error-message {
            background: rgba(255, 0, 100, 0.1);
            border: 1px solid rgba(255, 0, 100, 0.3);
            color: #ff0064;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            display: none;
        }

        .success-message {
            background: rgba(0, 255, 200, 0.1);
            border: 1px solid rgba(0, 255, 200, 0.3);
            color: #00ffc8;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            display: none;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .container {
                padding: 6rem 1rem 2rem;
            }
            
            .mint-controls {
                flex-direction: column;
                gap: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="logo">
            üõ°Ô∏è GuardianShield
        </div>
        <div class="wallet-section">
            <span id="walletAddress" class="wallet-address"></span>
            <button id="connectWallet" class="btn btn-primary">
                üîó Connect Wallet
            </button>
            <button id="disconnectWallet" class="btn btn-secondary" style="display: none;">
                ‚ùå Disconnect
            </button>
        </div>
    </nav>

    <div class="container">
        <!-- Hero Section -->
        <div class="hero">
            <h1>Security Shield NFT Collection</h1>
            <p>
                Unique NFT tokens with individual serial numbers, theft protection, 
                and automatic recovery system. Each Shield provides different levels 
                of protection and benefits within the GuardianShield ecosystem.
            </p>
        </div>

        <!-- Error/Success Messages -->
        <div id="errorMessage" class="error-message"></div>
        <div id="successMessage" class="success-message"></div>
        <div id="loadingIndicator" class="loading">
            <div class="spinner"></div>
            <p>Processing your transaction...</p>
        </div>

        <!-- Shield Types -->
        <div class="shield-types">
            <!-- Basic Shield -->
            <div class="shield-card" data-shield-type="Basic">
                <div class="shield-icon">üõ°Ô∏è</div>
                <div class="shield-name">Basic Shield</div>
                <div class="shield-protection">25% Protection</div>
                <div class="shield-price">0.01 ETH</div>
                <ul class="shield-features">
                    <li>Basic theft protection</li>
                    <li>Serial number tracking</li>
                    <li>Recovery system access</li>
                    <li>Community features</li>
                </ul>
                <button class="btn btn-primary mint-shield" data-type="Basic" data-price="0.01">
                    Mint Basic Shield
                </button>
            </div>

            <!-- Premium Shield -->
            <div class="shield-card" data-shield-type="Premium">
                <div class="shield-icon">‚öîÔ∏è</div>
                <div class="shield-name">Premium Shield</div>
                <div class="shield-protection">50% Protection</div>
                <div class="shield-price">0.05 ETH</div>
                <ul class="shield-features">
                    <li>Enhanced protection</li>
                    <li>Priority recovery</li>
                    <li>Advanced tracking</li>
                    <li>Exclusive rewards</li>
                </ul>
                <button class="btn btn-primary mint-shield" data-type="Premium" data-price="0.05">
                    Mint Premium Shield
                </button>
            </div>

            <!-- Elite Shield -->
            <div class="shield-card" data-shield-type="Elite">
                <div class="shield-icon">‚ö°</div>
                <div class="shield-name">Elite Shield</div>
                <div class="shield-protection">75% Protection</div>
                <div class="shield-price">0.1 ETH</div>
                <ul class="shield-features">
                    <li>Elite protection level</li>
                    <li>Instant recovery</li>
                    <li>Premium support</li>
                    <li>Governance rights</li>
                </ul>
                <button class="btn btn-primary mint-shield" data-type="Elite" data-price="0.1">
                    Mint Elite Shield
                </button>
            </div>

            <!-- Guardian Shield -->
            <div class="shield-card" data-shield-type="Guardian">
                <div class="shield-icon">üëë</div>
                <div class="shield-name">Guardian Shield</div>
                <div class="shield-protection">100% Protection</div>
                <div class="shield-price">0.25 ETH</div>
                <ul class="shield-features">
                    <li>Maximum protection</li>
                    <li>VIP treatment</li>
                    <li>All features unlocked</li>
                    <li>Special privileges</li>
                </ul>
                <button class="btn btn-primary mint-shield" data-type="Guardian" data-price="0.25">
                    Mint Guardian Shield
                </button>
            </div>
        </div>

        <!-- Batch Minting -->
        <div class="mint-section">
            <h3 style="text-align: center; margin-bottom: 2rem; color: #00ffc8;">üéØ Batch Mint Shields</h3>
            <div class="mint-controls">
                <div class="quantity-selector">
                    <button class="quantity-btn" onclick="updateQuantity(-1)">‚àí</button>
                    <span class="quantity-display" id="mintQuantity">1</span>
                    <button class="quantity-btn" onclick="updateQuantity(1)">+</button>
                </div>
                <select id="batchShieldType" class="btn btn-secondary" style="padding: 0.75rem 1rem;">
                    <option value="Basic">Basic Shield (0.01 ETH)</option>
                    <option value="Premium">Premium Shield (0.05 ETH)</option>
                    <option value="Elite">Elite Shield (0.1 ETH)</option>
                    <option value="Guardian">Guardian Shield (0.25 ETH)</option>
                </select>
                <button id="batchMintBtn" class="btn btn-primary">
                    üöÄ Batch Mint (<span id="totalCost">0.01</span> ETH)
                </button>
            </div>
        </div>

        <!-- Your Shields -->
        <div class="your-shields">
            <h3 style="color: #00ffc8; margin-bottom: 1rem;">üèÜ Your Shield Collection</h3>
            <div id="userShields" class="shields-grid">
                <!-- User shields will be loaded here -->
            </div>
        </div>

        <!-- Contract Statistics -->
        <div class="stats-section">
            <div class="stat-card">
                <div class="stat-number" id="totalMinted">0</div>
                <div class="stat-label">Total Minted</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalBurned">0</div>
                <div class="stat-label">Total Burned</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalRecovered">0</div>
                <div class="stat-label">Total Recovered</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="nextSerial">100001</div>
                <div class="stat-label">Next Serial #</div>
            </div>
        </div>
    </div>

    <script>
        let web3;
        let shieldNFTContract;
        let userAccount;
        let mintQuantity = 1;

        // Contract configuration - will be updated by deployment script
        const CONFIG = {
            SHIELD_NFT_ADDRESS: '0x...', // Will be updated by deployment
            SHIELD_NFT_ABI: [
                // Simplified ABI - add full ABI after deployment
                "function mintShield(address to, string memory shieldType, string memory metadata) external payable returns (uint256)",
                "function batchMintShields(address to, string[] memory shieldTypes, string[] memory metadataArray, uint256 quantity) external payable returns (uint256[] memory)",
                "function getTokensOfOwner(address owner) external view returns (uint256[] memory)",
                "function getShieldDetails(uint256 tokenId) external view returns (tuple(uint256 serialNumber, string shieldType, uint256 protectionLevel, uint256 mintTimestamp, address originalOwner, bool isStolen, uint256 stolenTimestamp, string metadata))",
                "function getContractStats() external view returns (tuple(uint256 _totalMinted, uint256 _totalBurned, uint256 _totalRecovered, uint256 _totalSupply, uint256 _nextSerial))",
                "function reportStolen(uint256 tokenId) external",
                "function shieldTypeCost(string memory shieldType) external view returns (uint256)"
            ]
        };

        // Initialize the application
        async function initApp() {
            console.log('üõ°Ô∏è Initializing GuardianShield NFT App...');
            
            // Check if Web3 is available
            if (typeof window.ethereum !== 'undefined') {
                web3 = new Web3(window.ethereum);
                console.log('‚úÖ Web3 detected');
                
                // Set up event listeners
                setupEventListeners();
                
                // Load contract statistics
                await loadContractStats();
                
                // Check if wallet is already connected
                const accounts = await web3.eth.getAccounts();
                if (accounts.length > 0) {
                    userAccount = accounts[0];
                    updateWalletUI(true);
                    await loadUserShields();
                }
            } else {
                showError('Please install MetaMask or another Web3 wallet to use this application.');
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('connectWallet').addEventListener('click', connectWallet);
            document.getElementById('disconnectWallet').addEventListener('click', disconnectWallet);
            document.getElementById('batchMintBtn').addEventListener('click', batchMint);
            
            // Shield type selector change
            document.getElementById('batchShieldType').addEventListener('change', updateBatchCost);
            
            // Individual mint buttons
            document.querySelectorAll('.mint-shield').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const shieldType = e.target.dataset.type;
                    const price = e.target.dataset.price;
                    mintSingleShield(shieldType, price);
                });
            });

            // Account change listener
            if (window.ethereum) {
                window.ethereum.on('accountsChanged', handleAccountsChanged);
                window.ethereum.on('chainChanged', handleChainChanged);
            }
        }

        // Connect wallet
        async function connectWallet() {
            try {
                showLoading(true);
                
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                userAccount = accounts[0];
                updateWalletUI(true);
                
                // Initialize contract
                shieldNFTContract = new web3.eth.Contract(CONFIG.SHIELD_NFT_ABI, CONFIG.SHIELD_NFT_ADDRESS);
                
                // Load user data
                await loadUserShields();
                
                showSuccess('Wallet connected successfully!');
                showLoading(false);
            } catch (error) {
                console.error('Wallet connection error:', error);
                showError('Failed to connect wallet: ' + error.message);
                showLoading(false);
            }
        }

        // Disconnect wallet
        function disconnectWallet() {
            userAccount = null;
            shieldNFTContract = null;
            updateWalletUI(false);
            document.getElementById('userShields').innerHTML = '';
            showSuccess('Wallet disconnected successfully!');
        }

        // Update wallet UI
        function updateWalletUI(connected) {
            const connectBtn = document.getElementById('connectWallet');
            const disconnectBtn = document.getElementById('disconnectWallet');
            const walletAddress = document.getElementById('walletAddress');

            if (connected && userAccount) {
                connectBtn.style.display = 'none';
                disconnectBtn.style.display = 'inline-flex';
                walletAddress.textContent = `${userAccount.substring(0, 6)}...${userAccount.substring(userAccount.length - 4)}`;
            } else {
                connectBtn.style.display = 'inline-flex';
                disconnectBtn.style.display = 'none';
                walletAddress.textContent = '';
            }
        }

        // Mint single shield
        async function mintSingleShield(shieldType, priceEth) {
            if (!userAccount) {
                showError('Please connect your wallet first.');
                return;
            }

            try {
                showLoading(true);
                
                const priceWei = web3.utils.toWei(priceEth, 'ether');
                const metadata = `${shieldType} Shield - Minted on ${new Date().toISOString()}`;
                
                const transaction = await shieldNFTContract.methods.mintShield(
                    userAccount,
                    shieldType,
                    metadata
                ).send({
                    from: userAccount,
                    value: priceWei
                });
                
                showSuccess(`${shieldType} Shield minted successfully! Transaction: ${transaction.transactionHash}`);
                
                // Reload user shields and stats
                await loadUserShields();
                await loadContractStats();
                
                showLoading(false);
            } catch (error) {
                console.error('Minting error:', error);
                showError('Failed to mint shield: ' + error.message);
                showLoading(false);
            }
        }

        // Batch mint shields
        async function batchMint() {
            if (!userAccount) {
                showError('Please connect your wallet first.');
                return;
            }

            const shieldType = document.getElementById('batchShieldType').value;
            const quantity = mintQuantity;

            try {
                showLoading(true);
                
                // Get shield price
                const shieldPrices = {
                    'Basic': '0.01',
                    'Premium': '0.05',
                    'Elite': '0.1',
                    'Guardian': '0.25'
                };
                
                const pricePerToken = shieldPrices[shieldType];
                const totalPrice = web3.utils.toWei((parseFloat(pricePerToken) * quantity).toString(), 'ether');
                
                // Prepare arrays
                const shieldTypes = Array(quantity).fill(shieldType);
                const metadataArray = Array(quantity).fill().map((_, i) => 
                    `${shieldType} Shield #${i + 1} - Batch minted on ${new Date().toISOString()}`
                );
                
                const transaction = await shieldNFTContract.methods.batchMintShields(
                    userAccount,
                    shieldTypes,
                    metadataArray,
                    quantity
                ).send({
                    from: userAccount,
                    value: totalPrice
                });
                
                showSuccess(`${quantity} ${shieldType} Shields minted successfully! Transaction: ${transaction.transactionHash}`);
                
                // Reload user shields and stats
                await loadUserShields();
                await loadContractStats();
                
                showLoading(false);
            } catch (error) {
                console.error('Batch minting error:', error);
                showError('Failed to batch mint shields: ' + error.message);
                showLoading(false);
            }
        }

        // Load user shields
        async function loadUserShields() {
            if (!userAccount || !shieldNFTContract) return;

            try {
                const tokenIds = await shieldNFTContract.methods.getTokensOfOwner(userAccount).call();
                const shieldsContainer = document.getElementById('userShields');
                
                if (tokenIds.length === 0) {
                    shieldsContainer.innerHTML = '<p style="color: #b0b0b0; text-align: center; grid-column: 1 / -1;">No shields owned yet. Mint your first shield above!</p>';
                    return;
                }
                
                shieldsContainer.innerHTML = '';
                
                for (const tokenId of tokenIds) {
                    const details = await shieldNFTContract.methods.getShieldDetails(tokenId).call();
                    
                    const shieldElement = createShieldElement(tokenId, details);
                    shieldsContainer.appendChild(shieldElement);
                }
            } catch (error) {
                console.error('Error loading user shields:', error);
                showError('Failed to load your shields: ' + error.message);
            }
        }

        // Create shield element
        function createShieldElement(tokenId, details) {
            const div = document.createElement('div');
            div.className = 'owned-shield';
            
            const statusClass = details.isStolen ? 'status-stolen' : 'status-safe';
            const statusText = details.isStolen ? 'STOLEN' : 'SAFE';
            
            div.innerHTML = `
                <div class="shield-serial">#${details.serialNumber}</div>
                <div style="color: #fff; font-weight: 600; margin-bottom: 0.5rem;">${details.shieldType}</div>
                <div style="color: #0088ff; font-size: 0.9rem;">${details.protectionLevel}% Protection</div>
                <div class="shield-status ${statusClass}">${statusText}</div>
                ${details.isStolen ? '' : `
                    <button class="btn btn-secondary" style="margin-top: 1rem; font-size: 0.8rem; padding: 0.5rem 1rem;" 
                            onclick="reportStolen(${tokenId})">
                        üö® Report Stolen
                    </button>
                `}
            `;
            
            return div;
        }

        // Report stolen shield
        async function reportStolen(tokenId) {
            if (!confirm('Are you sure you want to report this shield as stolen? This action cannot be undone.')) {
                return;
            }

            try {
                showLoading(true);
                
                const transaction = await shieldNFTContract.methods.reportStolen(tokenId).send({
                    from: userAccount
                });
                
                showSuccess(`Shield reported as stolen. Transaction: ${transaction.transactionHash}`);
                
                // Reload user shields
                await loadUserShields();
                
                showLoading(false);
            } catch (error) {
                console.error('Error reporting stolen shield:', error);
                showError('Failed to report stolen shield: ' + error.message);
                showLoading(false);
            }
        }

        // Load contract statistics
        async function loadContractStats() {
            try {
                if (!shieldNFTContract) {
                    // Create contract instance for reading stats
                    shieldNFTContract = new web3.eth.Contract(CONFIG.SHIELD_NFT_ABI, CONFIG.SHIELD_NFT_ADDRESS);
                }
                
                const stats = await shieldNFTContract.methods.getContractStats().call();
                
                document.getElementById('totalMinted').textContent = stats._totalMinted;
                document.getElementById('totalBurned').textContent = stats._totalBurned;
                document.getElementById('totalRecovered').textContent = stats._totalRecovered;
                document.getElementById('nextSerial').textContent = stats._nextSerial;
            } catch (error) {
                console.error('Error loading contract stats:', error);
            }
        }

        // Update quantity
        function updateQuantity(change) {
            mintQuantity = Math.max(1, Math.min(50, mintQuantity + change));
            document.getElementById('mintQuantity').textContent = mintQuantity;
            updateBatchCost();
        }

        // Update batch cost
        function updateBatchCost() {
            const shieldType = document.getElementById('batchShieldType').value;
            const shieldPrices = {
                'Basic': 0.01,
                'Premium': 0.05,
                'Elite': 0.1,
                'Guardian': 0.25
            };
            
            const totalCost = (shieldPrices[shieldType] * mintQuantity).toFixed(3);
            document.getElementById('totalCost').textContent = totalCost;
        }

        // Handle account changes
        function handleAccountsChanged(accounts) {
            if (accounts.length === 0) {
                disconnectWallet();
            } else if (accounts[0] !== userAccount) {
                userAccount = accounts[0];
                updateWalletUI(true);
                loadUserShields();
            }
        }

        // Handle chain changes
        function handleChainChanged() {
            window.location.reload();
        }

        // Utility functions
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 5000);
        }

        function showLoading(show) {
            const loadingDiv = document.getElementById('loadingIndicator');
            if (show) {
                loadingDiv.classList.add('active');
            } else {
                loadingDiv.classList.remove('active');
            }
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>