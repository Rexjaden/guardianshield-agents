
FROM python:3.11-slim

WORKDIR /app

# Install dependencies
COPY requirements.txt .
RUN pip install -r requirements.txt

# Copy blockchain core
COPY guardianshield_chain_core.py .
COPY node_startup.py .

# Expose blockchain port
EXPOSE 8333

# Health check using Python (no curl needed)
HEALTHCHECK --interval=30s --timeout=10s --start-period=10s --retries=3 \
    CMD ["python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8334/health', timeout=5)"]

# Start node
CMD ["python", "node_startup.py"]
